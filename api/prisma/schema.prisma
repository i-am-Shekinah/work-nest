generator client {
  provider     = "prisma-client"
  output       = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN
  STAFF
}

enum UserStatus {
  PENDING
  ACTIVE
  INACTIVE
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

model User {
  id                   String      @id @default(cuid(2))
  email                String      @unique
  hashedPassword       String?
  firstName            String
  lastName             String
  role                 UserRole
  status               UserStatus  @default(PENDING)
  profilePictureUrl    String?
  departmentId         String
  department           Department  @relation(fields: [departmentId], references: [id])
  headedDepartment     Department? @relation("DepartmentHOD")
  bookings             Booking[]
  resetPasswordToken   String?
  resetPasswordExpires DateTime?
  createdAt            DateTime    @default(now())
  updatedAt            DateTime    @updatedAt

  @@map("users")
}

model Department {
  id        String    @id @default(cuid(2))
  name      String
  users     User[]
  hodId     String?   @unique
  hod       User?     @relation("DepartmentHOD", fields: [hodId], references: [id])
  isDeleted Boolean   @default(false)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt()
  deletedAt DateTime?

  @@unique([name, deletedAt])
  @@map("departments")
}

model Client {
  id        String    @id @default(cuid(2))
  firstName String
  lastName  String
  email     String    @unique
  phone     String
  notes     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  bookings  Booking[]

  @@map("clients")
}

model Booking {
  id             String        @id @default(cuid(2))
  title          String
  description    String?
  status         BookingStatus
  startTime      DateTime
  endTime        DateTime
  assignedUserId String
  user           User          @relation(fields: [assignedUserId], references: [id])
  clientId       String
  client         Client        @relation(fields: [clientId], references: [id])
  isDeleted      Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  deletedAt      DateTime?

  @@map("bookings")
}
